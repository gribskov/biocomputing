<!DOCTYPE html>
<html>
<head>
    <meta http-equiv='content-type' content='text/html; charset=utf-8'>

    <title>Koll&#234;ma</title>
    <meta name="description" content="Transcript annotation">
    <meta name="author" content="Michael Gribskov">

    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/skeleton.css">
    <link rel="stylesheet" href="/css/kollema.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet">
    <!--link href="http://fonts.useso.com/css?family=Raleway:400,300,600" rel="stylesheet"-->
    <script type='text/javascript'
        src='https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js'>
    </script>

    <script type='text/javascript'
        src='static/kollema.js'>
    </script>

    <script type='text/javascript'>

        function projects(user) {
            $('#projects').append('<h2>' + user + '</h2>');
            $('#projects').load('/getProjects?user='+user);
            $("body").on("click", '#project_table tr', function() {
                //console.log(this);
                $('.selected').removeClass('selected');
                $(this).addClass("selected");
            });

        }

        function addProject() {
            var target = 'name=' + $("#proj_name").val() + '&desc=' + $("#proj_desc").val();
            //alert(target);
            var request = $.ajax({'url': '/addProject?' + target});
            request.done(function(response) {
                $('#projects').load('/getProjects?user='+response.user);
                closeModal('new_project');
            });
        }

        function selectProject() {
            //alert("selectProject "+$(".selected td:first-child").text());
            var target = 'project_id=' + $(".selected td:first-child").text();
            console.log(target);
            var request = $.ajax({'url': '/setProject?' + target});
        }

        $(document).ready(function() {
            /* $$user is substituted with user id when page is loaded by kollemaview.py */
            projects('$$user');
           });

    </script>
</head>

<body>

<div class="container">
    <!-- Header -->
    <div class="section header">
        <div class="twelve columns" style="margin:20px;">
            <h1 class="title" id="ttt"><em>Koll&#234;ma</em></h1>
        </div>
    </div>

    <!-- main content -->
    <div class="twelve columns" style="margin:20px;">
        <!-- left menu -->
        <div class="two columns" style="margin-right:10px;">
            <div id="menu" >
            <h6>Menu</h6>
            <a class="menubutton" onclick="openModalUrl('static/signon.html #signin', '#reg')">Change user</a><br/>
            <a class="menubutton">Show projects</a><br/>
            <a class="menubutton">Load transcripts</a>
            </div>
        </div>

        <!-- change user dialog -->
        <div id="reg" class="modal four columns">
        </div>

        <!-- projects panel -->
        <div class="six columns" style="margin:0px 10px;">
            <div id="projects">
            </div>
            <a class="button" onclick="selectProject()">Select</a>
            <a class="button" onclick="openModal('static/signon.html', 'new_project')">New Project</a>
        </div>

        <div class="four columns">
            <h2>block2</h2>
        </div>

        <div id="new_project" class="modal four columns" style="display:none">
            <form action="dashboard">
                <div class="modal-content" >

                    <span onclick="closeModal('new_project')" class="close" title="Close">&curvearrowright;</span>
                    <input type="text" id="proj_name" name="proj_name" placeholder="Please enter project name" style="width:100%"><br/>
                    <textarea id="proj_desc" name="proj_desc" placeholder="Please enter project description" style="width:100%;height:60px;padding:6px 10px;"></textarea><br/>

                    <input type="button" onclick="addProject()" value="make it so">
                    <input type="button" onclick="closeModal('new_project')" value="Cancel">

                </div>
            </form>
        </div>

    </div>
<div>

</body>
</html>